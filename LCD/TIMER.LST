8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    1


DOS 5.0 (038-N) 8086/87/88/186 MACRO ASSEMBLER V3.1 ASSEMBLY OF MODULE TIMER
OBJECT MODULE PLACED IN TIMER.OBJ
ASSEMBLER INVOKED BY:  F:\ASM86.EXE TIMER.ASM


LOC  OBJ                  LINE     SOURCE

                             1 +1  $MOD186
                             2 +1  $EP
                             3     NAME TIMER
                             4     
                             5     ; =========================================================================
                             6     ; Main Timer Driver Program
                             7     ; Author: Vaghul Aditya Balaji
                             8     
                             9     ; This file contains proprietary information and cannot be copied 
                            10     ; or distributed without prior permission from the author.
                            11     ; =========================================================================
                            12     
                            13     public  serial_rec_action, timer2_action
                            14     extrn   print_char:far, print_2hex:far, iodefine:far
                            15     extrn   set_timer2:far, disable_timer2:far
                            16     
                            17     
                            18     ;IO Setup for 80C188 
  FFA0                      19             UMCR                            EQU    0FFA0H ; Upper Memory Control Register
  FFA2                      20             LMCR                            EQU    0FFA2H ; Lower Memory control Register
                                            
  FFA4                      21             PCSBA                   EQU    0FFA4H ; Peripheral Chip Select Base Address
  FFA8                      22             MPCS                    EQU    0FFA8H ; MMCS and PCS Alter Control Register
  FF38                      23             INT0CON                 EQU    0FF38H
  FF22                      24             EOI                     EQU    0FF22H
  FF28                      25             IMASK                   EQU    0FF28H   
  0080                      26             PORTA                   EQU    0080H
  0081                      27             PORTB                   EQU    0081H
  0082                      28             PORTC                   EQU    0082H
  0083                      29             CWR                     EQU    0083H
  0050                      30             TIMER2_LEN                      EQU    80
  0064                      31             LINE1_LIMIT             EQU    100
  0032                      32             LINE2_LIMIT             EQU    50
  0010                      33             LCD_DISPLAY_LIMIT   EQU    16
  000A                      34             ROLL_LIMIT              EQU    10
                            35     
                            36             
----                        37     STACK_SEG       SEGMENT
0000 (256                   38             DB      256 DUP(?)
     ??
     )
0100                        39             TOS     LABEL   WORD
----                        40     STACK_SEG       ENDS
                            41     
                            42     
----                        43     DATA_SEG        SEGMENT
0000 0A                     44             TIMER2_MESS       DB  10,13,'TIMER2 INTERRUPT    '
0001 0D
0002 54494D45523220
     494E5445525255
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    2


LOC  OBJ                  LINE     SOURCE

     505420202020
0016 2F                     45             T_COUNT           DB  2FH
0017 2F                     46             T_COUNT_SET       DB  2FH
0018 0A                     47             REC_MESS          DB  10,13,'Period of timer =     '
0019 0D
001A 506572696F6420
     6F662074696D65
     72203D20202020
     20
                            48             
                            49             ;LCD Variables
0030 (25                    50             DISP_LINE1    DB  25 DUP(' ')
     20
     )
0049 (25                    51                                       DB  25 DUP(' ')
     20
     )
0062 (25                    52                                       DB  25 DUP(' ')
     20
     )
007B (25                    53                                       DB  25 DUP(' ')
     20
     )
0094 (25                    54             DISP_LINE2    DB  25 DUP(' ')
     20
     )
00AD (25                    55                                       DB  25 DUP(' ')
     20
     )
00C6 00                     56             LINE1_COUNT   DB  00H
00C7 00                     57             LINE2_COUNT   DB  00H
00C8 0000                   58             TIMER2_COUNT  DW  0000H
00CA 00                     59             ROLL_COUNT    DB  00H
                            60             
                            61             ;Serial Variables
00CB 00                     62             RECEIVE_FLAG  DB  00H
00CC 00                     63             LINE2_FLAG    DB  00H
00CD 4C333030325D           64             LCD_ID        DB  'L3002]'
00D3 00                     65             LCD_START     DB  00H
00D4 00                     66             LCD_FLAG          DB  00H
00D5 00                     67             START_READ    DB  00H
----                        68     DATA_SEG        ENDS
                            69     
                            70     
----                        71     CODE_SEG        SEGMENT
                            72     
                            73             PUBLIC          START
                            74     
                            75     ASSUME  CS:CODE_SEG, SS:STACK_SEG, DS:DATA_SEG
                            76     
0000                        77     START:
                            78     ;initialize stack area
0000 B8----         R       79             MOV     AX,STACK_SEG            
0003 8ED0                   80             MOV     SS,AX
0005 368B260001             81             MOV     SP,TOS
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    3


LOC  OBJ                  LINE     SOURCE

                            82             
000A B8----         R       83             MOV AX, DATA_SEG
000D 8ED8                   84             MOV DS, AX
                            85     
                            86     ; Initialize the on-chip peripherals
000F 9A0000----     E       87             CALL FAR PTR IODEFINE
                            88                     
                            89     ; Initialize MPCS to MAP peripheral to IO address       
0014 BAA8FF                 90             MOV DX, MPCS
0017 B88300                 91             MOV AX, 0083H
001A EF                     92             OUT DX, AX
                            93     
                            94     ; PCSBA initial, set the parallel port start from 00H
001B BAA4FF                 95             MOV DX, PCSBA
001E B80300                 96             MOV AX, 0003H ; Peripheral starting address 00H no READY, No Waits
0021 EF                     97             OUT DX, AX
                            98     
                            99     ; Initialize LMCS 
0022 BAA2FF                100         MOV DX, LMCR
0025 B8C401                101         MOV AX, 01C4H  ; Starting address 1FFFH, 8K, No waits, last should be 5H for 1 wa
                                   its      
0028 EF                    102         OUT DX, AX
                           103     
                           104     ; ######################### Start of User Main Routine ###########################
                           105             
0029 FB                    106         STI
                           107             
002A BA8300                108             MOV DX, CWR
002D B88000                109             MOV AX, 80H
0030 EE                    110             OUT DX, AL
                           111             
0031                       112     NEXT:
0031 EBFE                  113             JMP NEXT
                           114             
                           115     ; ######################### End of User Main Routine #############################
                           116     
                           117     
                           118     ;Procedure for initializing the LCD system and setting it up for display
0033                       119     LCD_INITIALIZE PROC FAR
0033 50                    120             PUSH AX
0034 51                    121             PUSH CX
0035 52                    122             PUSH DX
                           123     
                           124     ; ****Time Delay of 60ms****    
0036 33C9                  125             XOR CX, CX
0038 B93075                126             MOV CX, 30000   
                           127     
003B                       128     DELAY_60ms:
003B E2FE                  129             LOOP DELAY_60ms
                           130             
003D 33C9                  131             XOR CX, CX
                           132     
                           133     ; *****Function Set****
003F 33C0                  134             XOR AX, AX
0041 BA8200                135             MOV DX, PORTC
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    4


LOC  OBJ                  LINE     SOURCE

0044 B008                  136             MOV AL, 08H
0046 EE                    137             OUT DX, AL
                           138     
0047 33C0                  139             XOR AX, AX
0049 BA8100                140             MOV DX, PORTB
004C B03C                  141             MOV AL, 3CH
004E EE                    142             OUT DX, AL
                           143     
004F 33C0                  144             XOR AX, AX
0051 BA8200                145             MOV DX, PORTC
0054 B000                  146             MOV AL, 00H
0056 EE                    147             OUT DX, AL
                           148     ; **********************
                           149     
                           150     ; ****Time Delay of 5ms****     
0057 33C9                  151             XOR CX, CX
0059 B9C409                152             MOV CX, 2500
                           153     
005C                       154     DELAY_5ms:
005C E2FE                  155             LOOP DELAY_5ms
                           156             
005E 33C9                  157             XOR CX, CX      
                           158     
                           159     ; *****Function Set****
0060 33C0                  160             XOR AX, AX
0062 BA8200                161             MOV DX, PORTC
0065 B008                  162             MOV AL, 08H
0067 EE                    163             OUT DX, AL
                           164     
0068 33C0                  165             XOR AX, AX
006A BA8100                166             MOV DX, PORTB
006D B03C                  167             MOV AL, 3CH
006F EE                    168             OUT DX, AL
                           169     
0070 33C0                  170             XOR AX, AX
0072 BA8200                171             MOV DX, PORTC
0075 B000                  172             MOV AL, 00H
0077 EE                    173             OUT DX, AL
                           174     ; **********************
                           175     
                           176     ; ****Time Delay of 100us****   
0078 33C9                  177             XOR CX, CX
007A B93200                178             MOV CX, 50
                           179     
007D                       180     DELAY_100us:
007D E2FE                  181             LOOP DELAY_100us
                           182             
007F 33C9                  183             XOR CX, CX
                           184     
                           185     ; *****Function Set****
0081 33C0                  186             XOR AX, AX
0083 BA8200                187             MOV DX, PORTC
0086 B008                  188             MOV AL, 08H
0088 EE                    189             OUT DX, AL
                           190     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    5


LOC  OBJ                  LINE     SOURCE

0089 33C0                  191             XOR AX, AX
008B BA8100                192             MOV DX, PORTB
008E B03C                  193             MOV AL, 3CH
0090 EE                    194             OUT DX, AL
                           195     
0091 33C0                  196             XOR AX, AX
0093 BA8200                197             MOV DX, PORTC
0096 B000                  198             MOV AL, 00H
0098 EE                    199             OUT DX, AL
                           200     ; **********************
                           201     
                           202     ; *****Function Set****
0099 33C0                  203             XOR AX, AX
009B BA8200                204             MOV DX, PORTC
009E B008                  205             MOV AL, 08H
00A0 EE                    206             OUT DX, AL
                           207     
00A1 33C0                  208             XOR AX, AX
00A3 BA8100                209             MOV DX, PORTB
00A6 B03C                  210             MOV AL, 3CH
00A8 EE                    211             OUT DX, AL
                           212     
00A9 33C0                  213             XOR AX, AX
00AB BA8200                214             MOV DX, PORTC
00AE B000                  215             MOV AL, 00H
00B0 EE                    216             OUT DX, AL
                           217     ; **********************
                           218     
00B1 E80C01                219             CALL LCD_POLL
                           220     
                           221     ; *****Switching off Display****
00B4 33C0                  222             XOR AX, AX
00B6 BA8200                223             MOV DX, PORTC
00B9 B008                  224             MOV AL, 08H
00BB EE                    225             OUT DX, AL
                           226     
00BC 33C0                  227             XOR AX, AX
00BE BA8100                228             MOV DX, PORTB
00C1 B008                  229             MOV AL, 08H
00C3 EE                    230             OUT DX, AL
                           231     
00C4 33C0                  232             XOR AX, AX
00C6 BA8200                233             MOV DX, PORTC
00C9 B000                  234             MOV AL, 00H
00CB EE                    235             OUT DX, AL
                           236     ; **********************
                           237     
00CC E8F100                238             CALL LCD_POLL
                           239     
                           240     ; *****Clear the LCD****
00CF 33C0                  241             XOR AX, AX
00D1 BA8200                242             MOV DX, PORTC
00D4 B008                  243             MOV AL, 08H
00D6 EE                    244             OUT DX, AL
                           245     
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    6


LOC  OBJ                  LINE     SOURCE

00D7 33C0                  246             XOR AX, AX
00D9 BA8100                247             MOV DX, PORTB
00DC B001                  248             MOV AL, 01H
00DE EE                    249             OUT DX, AL
                           250     
00DF 33C0                  251             XOR AX, AX
00E1 BA8200                252             MOV DX, PORTC
00E4 B000                  253             MOV AL, 00H
00E6 EE                    254             OUT DX, AL
                           255     ; **********************
                           256     
00E7 E8D600                257             CALL LCD_POLL
                           258     
                           259     ; *****Enable Entry Mode****
00EA 33C0                  260             XOR AX, AX
00EC BA8200                261             MOV DX, PORTC
00EF B008                  262             MOV AL, 08H
00F1 EE                    263             OUT DX, AL
                           264     
00F2 33C0                  265             XOR AX, AX
00F4 BA8100                266             MOV DX, PORTB
00F7 B006                  267             MOV AL, 06H
00F9 EE                    268             OUT DX, AL
                           269     
00FA 33C0                  270             XOR AX, AX
00FC BA8200                271             MOV DX, PORTC
00FF B000                  272             MOV AL, 00H
0101 EE                    273             OUT DX, AL
                           274     ; **********************
                           275     
0102 E8BB00                276             CALL LCD_POLL
                           277     
0105                       278     LCD_INIT_END:
0105 5A                    279             POP DX
0106 59                    280             POP CX
0107 58                    281             POP AX
0108 CB                    282             RET
                           283     LCD_INITIALIZE ENDP
                           284     
                           285     
                           286     ;Procedure for displaying characters on the LCD
0109                       287     LCD_DISPLAY PROC FAR
0109 50                    288             PUSH AX
010A 53                    289             PUSH BX
010B 51                    290             PUSH CX
010C 52                    291             PUSH DX
                           292     
                           293     ; *****Set First Line****
010D 33C0                  294             XOR AX, AX
010F BA8200                295             MOV DX, PORTC
0112 B008                  296             MOV AL, 08H
0114 EE                    297             OUT DX, AL
                           298     
0115 33C0                  299             XOR AX, AX
0117 BA8100                300             MOV DX, PORTB
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    7


LOC  OBJ                  LINE     SOURCE

011A B080                  301             MOV AL, 80H
011C EE                    302             OUT DX, AL
                           303     
011D 33C0                  304             XOR AX, AX
011F BA8200                305             MOV DX, PORTC
0122 B000                  306             MOV AL, 00H
0124 EE                    307             OUT DX, AL
                           308     ; **********************
                           309     
0125 E89800                310             CALL LCD_POLL
                           311     
                           312     ; *****Switching on Display****
0128 33C0                  313             XOR AX, AX
012A BA8200                314             MOV DX, PORTC
012D B008                  315             MOV AL, 08H
012F EE                    316             OUT DX, AL
                           317     
0130 33C0                  318             XOR AX, AX
0132 BA8100                319             MOV DX, PORTB
0135 B00C                  320             MOV AL, 0CH
0137 EE                    321             OUT DX, AL
                           322     
0138 33C0                  323             XOR AX, AX
013A BA8200                324             MOV DX, PORTC
013D B000                  325             MOV AL, 00H
013F EE                    326             OUT DX, AL
                           327     ; **********************
                           328     
0140 E87D00                329             CALL LCD_POLL
                           330     
0143 33DB                  331             XOR BX, BX
0145 33C9                  332             XOR CX, CX
0147 8A0EC600              333             MOV CL, DS:LINE1_COUNT  
014B 80F910                334             CMP CL, LCD_DISPLAY_LIMIT
014E 7E02                  335             JLE LINE1_LOOP
0150 B110                  336             MOV CL, LCD_DISPLAY_LIMIT
                           337     
                           338     ; **********To display Characters in first line************
0152                       339     LINE1_LOOP:
0152 33C0                  340             XOR AX, AX
0154 BA8200                341             MOV DX, PORTC
0157 B00A                  342             MOV AL, 0AH
0159 EE                    343             OUT DX, AL
                           344     
015A 33C0                  345             XOR AX, AX
015C BA8100                346             MOV DX, PORTB
015F 8A4730                347             MOV AL, DS:DISP_LINE1[BX]
0162 EE                    348             OUT DX, AL
                           349     
0163 33C0                  350             XOR AX, AX
0165 BA8200                351             MOV DX, PORTC
0168 B002                  352             MOV AL, 02H
016A EE                    353             OUT DX, AL
                           354     
016B E85200                355             CALL LCD_POLL
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    8


LOC  OBJ                  LINE     SOURCE

                           356             
016E 43                    357             INC BX
016F E2E1                  358             LOOP LINE1_LOOP
                           359     ; **********************************************************
                           360     
                           361     ; *****Set Second Line****
0171 33C0                  362             XOR AX, AX
0173 BA8200                363             MOV DX, PORTC
0176 B008                  364             MOV AL, 08H
0178 EE                    365             OUT DX, AL
                           366     
0179 33C0                  367             XOR AX, AX
017B BA8100                368             MOV DX, PORTB
017E B0C0                  369             MOV AL, 0C0H
0180 EE                    370             OUT DX, AL
                           371     
0181 33C0                  372             XOR AX, AX
0183 BA8200                373             MOV DX, PORTC
0186 B000                  374             MOV AL, 00H
0188 EE                    375             OUT DX, AL
                           376     ; **********************
                           377     
0189 E83400                378             CALL LCD_POLL
                           379     
018C 33C9                  380             XOR CX, CX
018E 33DB                  381             XOR BX, BX
0190 8A0EC700              382             MOV CL, DS:LINE2_COUNT
0194 80F910                383             CMP CL, LCD_DISPLAY_LIMIT
0197 7E02                  384             JLE LINE2_LOOP
0199 B110                  385             MOV CL, LCD_DISPLAY_LIMIT
                           386     
                           387     ; **********To display Characters in second line************
019B                       388     LINE2_LOOP:
019B 33C0                  389             XOR AX, AX
019D BA8200                390             MOV DX, PORTC
01A0 B00A                  391             MOV AL, 0AH
01A2 EE                    392             OUT DX, AL
                           393     
01A3 33C0                  394             XOR AX, AX
01A5 BA8100                395             MOV DX, PORTB
01A8 8A879400              396             MOV AL, DS:DISP_LINE2[BX]
01AC EE                    397             OUT DX, AL
                           398     
01AD 33C0                  399             XOR AX, AX
01AF BA8200                400             MOV DX, PORTC
01B2 B002                  401             MOV AL, 02H
01B4 EE                    402             OUT DX, AL
                           403     
01B5 E80800                404             CALL LCD_POLL
                           405             
01B8 43                    406             INC BX
01B9 E2E0                  407             LOOP LINE2_LOOP
                           408     ; **********************************************************
                           409     
01BB                       410     LCD_DISP_END:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE    9


LOC  OBJ                  LINE     SOURCE

01BB 5A                    411             POP DX
01BC 59                    412             POP CX
01BD 5B                    413             POP BX
01BE 58                    414             POP AX
01BF CB                    415             RET
                           416     LCD_DISPLAY ENDP
                           417     
                           418     
                           419     ;Procedure for checking the busy flag on the LCD to make sure it is ready to receive 
                                   input
01C0                       420     LCD_POLL PROC NEAR
01C0 50                    421             PUSH AX
01C1 52                    422             PUSH DX
                           423     
01C2 BA8300                424             MOV DX, CWR
01C5 B082                  425             MOV AL, 82H
01C7 EE                    426             OUT DX, AL
                           427     
01C8                       428     BUSY_POLL:      
01C8 B00C                  429             MOV AL, 0CH
01CA BA8200                430             MOV DX, PORTC
01CD EE                    431             OUT DX, AL
                           432                     
01CE BA8100                433             MOV DX, PORTB
01D1 EC                    434             IN AL, DX               
01D2 2480                  435             AND AL, 80H             
01D4 8AE0                  436             MOV AH, AL
                           437     
01D6 B004                  438             MOV AL, 04H
01D8 BA8200                439             MOV DX, PORTC
01DB EE                    440             OUT DX, AL      
                           441             
01DC 80FC00                442             CMP AH, 00H     
01DF 75E7                  443             JNZ BUSY_POLL
                           444             
01E1 BA8300                445             MOV DX, CWR
01E4 B080                  446             MOV AL, 80H
01E6 EE                    447             OUT DX, AL
                           448     
01E7                       449     LCD_POLL_END:   
01E7 5A                    450             POP DX
01E8 58                    451             POP AX
01E9 C3                    452             RET
                           453     LCD_POLL ENDP
                           454     
                           455     
                           456     ;Procedure that is called when a character is received via serial
01EA                       457     SERIAL_REC_ACTION PROC FAR
01EA 51                    458             PUSH CX
01EB 53                    459             PUSH BX
01EC 50                    460             PUSH AX
                           461     
01ED 803ED30001            462             CMP LCD_START, 01H
01F2 7464                  463             JE LCD_RECEIVE_START
                           464             
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE   10


LOC  OBJ                  LINE     SOURCE

01F4 803ED50001            465             CMP START_READ, 01H
01F9 7413                  466             JE START_READING_ID_VALUES
                           467             
01FB 3C5B                  468             CMP AL, '['
01FD 7403                  469             JE START_READING_ID
01FF EB5490                470             JMP TERMINATE_COMMUNICATION
                           471             
0202                       472     START_READING_ID:
0202 FE06D400              473             INC LCD_FLAG
0206 C606D50001            474             MOV START_READ, 01H
020B EB4890                475             JMP TERMINATE_COMMUNICATION
                           476             
020E                       477     START_READING_ID_VALUES:
020E 33DB                  478             XOR BX, BX
0210 8A1ED400              479             MOV BL, LCD_FLAG
0214 4B                    480             DEC BX  
0215 3A87CD00              481             CMP AL, LCD_ID[BX]
0219 753A                  482             JNE TERMINATE_COMMUNICATION
021B 803ED40006            483             CMP LCD_FLAG, 06H
0220 751D                  484             JNE NORMAL_ID_CHECK
0222 C606D30001            485             MOV LCD_START, 01H
0227 B02A                  486             MOV AL, '*'
0229 9A0000----     E      487             CALL FAR PTR PRINT_CHAR
022E B031                  488             MOV AL, '1'
0230 9A0000----     E      489             CALL FAR PTR PRINT_CHAR
0235 B02A                  490             MOV AL, '*'
0237 9A0000----     E      491             CALL FAR PTR PRINT_CHAR
023C EB1790                492             JMP TERMINATE_COMMUNICATION
                           493             
023F                       494     NORMAL_ID_CHECK:
023F FE06D400              495             INC LCD_FLAG
0243 E9C000                496             JMP END_SERIAL_COMMUNICATION
                           497     
0246                       498     INITIALIZE_TERMINATE_SERIAL:
0246 C606D30000            499             MOV LCD_START, 00H
024B C606D40000            500             MOV LCD_FLAG, 00H
0250 C606D50000            501             MOV START_READ, 00H
                           502             
0255                       503     TERMINATE_COMMUNICATION:
0255 E94701                504             JMP SERIAL_END
                           505             
0258                       506     LCD_RECEIVE_START:
0258 803ECC0001            507             CMP LINE2_FLAG, 01H
025D 7412                  508             JE RECEIVE_LINE2        
                           509             
025F 3C3E                  510             CMP AL, '>'
0261 7452                  511             JE SWITCH_TO_LINE2      
                           512             
0263 803ECB0001            513             CMP RECEIVE_FLAG, 01H
0268 7419                  514             JE RECEIVE_CHARACTER
                           515             
026A 3C3C                  516             CMP     AL,'<'
026C 7435                  517             JE SET_RECEIVE_FLAG
                           518             
026E E92E01                519             JMP SERIAL_END
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE   11


LOC  OBJ                  LINE     SOURCE

                           520             
0271                       521     RECEIVE_LINE2:          
0271 3C7D                  522             CMP AL, '}'
0273 7425                  523             JE FIRST_JUMP_DISPLAY_LCD
                           524             
0275 803ECB0001            525             CMP RECEIVE_FLAG, 01H
027A 7424                  526             JE FIRST_JUMP_RECEIVE_CHAR_LINE2
                           527             
027C 3C7B                  528             CMP     AL,'{'
027E 741D                  529             JE FIRST_JUMP_RECEIVE_FLAG_LINE2                
                           530             
0280 E91C01                531             JMP SERIAL_END
                           532             
0283                       533     RECEIVE_CHARACTER:
0283 803EC60064            534             CMP LINE1_COUNT, LINE1_LIMIT
0288 747C                  535             JE END_SERIAL_COMMUNICATION
028A 33DB                  536             XOR BX, BX
028C 8A1EC600              537             MOV BL, LINE1_COUNT
0290 884730                538             MOV DISP_LINE1[BX], AL
0293 FE06C600              539             INC LINE1_COUNT
0297 E90501                540             JMP SERIAL_END
                           541             
029A                       542     FIRST_JUMP_DISPLAY_LCD:
029A E99100                543             JMP DISPLAY_ON_LCD
                           544             
029D                       545     FIRST_JUMP_RECEIVE_FLAG_LINE2:
029D E98100                546             JMP SET_RECEIVE_FLAG_LINE2
                           547             
02A0                       548     FIRST_JUMP_RECEIVE_CHAR_LINE2:
02A0 EB6790                549             JMP RECEIVE_CHARACTER_LINE2
                           550             
02A3                       551     SET_RECEIVE_FLAG:
02A3 C606C60000            552             MOV LINE1_COUNT, 00H
02A8 C606CB0001            553             MOV RECEIVE_FLAG, 01H
02AD 9A0000----     E      554             CALL FAR PTR DISABLE_TIMER2
02B2 E9EA00                555             JMP SERIAL_END
                           556             
02B5                       557     SWITCH_TO_LINE2:
02B5 803EC60010            558             CMP LINE1_COUNT, LCD_DISPLAY_LIMIT
02BA 7E32                  559             JLE NORMAL_DISPLAY_LCD_LINE1
02BC 33DB                  560             XOR BX, BX
02BE 8A1EC600              561             MOV BL, LINE1_COUNT
02C2 C6473020              562             MOV DISP_LINE1[BX], ' '
02C6 FE06C600              563             INC LINE1_COUNT
02CA 8A1EC600              564             MOV BL, LINE1_COUNT
02CE C647302D              565             MOV DISP_LINE1[BX], '-'
02D2 FE06C600              566             INC LINE1_COUNT
02D6 8A1EC600              567             MOV BL, LINE1_COUNT
02DA C647302D              568             MOV DISP_LINE1[BX], '-'
02DE FE06C600              569             INC LINE1_COUNT
02E2 8A1EC600              570             MOV BL, LINE1_COUNT
02E6 C6473020              571             MOV DISP_LINE1[BX], ' '
02EA FE06C600              572             INC LINE1_COUNT
                           573     
02EE                       574     NORMAL_DISPLAY_LCD_LINE1:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE   12


LOC  OBJ                  LINE     SOURCE

02EE 803ECB0000            575             CMP RECEIVE_FLAG, 00H
02F3 7411                  576             JE END_SERIAL_COMMUNICATION
02F5 803EC60000            577             CMP LINE1_COUNT, 00H
02FA 7487                  578             JE RECEIVE_CHARACTER            
02FC C606CB0000            579             MOV RECEIVE_FLAG, 00H
0301 C606CC0001            580             MOV LINE2_FLAG, 01H
                           581             
0306                       582     END_SERIAL_COMMUNICATION:
0306 E99600                583             JMP SERIAL_END  
                           584             
0309                       585     RECEIVE_CHARACTER_LINE2:
0309 803EC70032            586             CMP LINE2_COUNT, LINE2_LIMIT
030E 74F6                  587             JE END_SERIAL_COMMUNICATION
0310 33DB                  588             XOR BX, BX
0312 8A1EC700              589             MOV BL, LINE2_COUNT
0316 88879400              590             MOV DISP_LINE2[BX], AL
031A FE06C700              591             INC LINE2_COUNT
031E EB7F90                592             JMP SERIAL_END
                           593             
0321                       594     SET_RECEIVE_FLAG_LINE2:
0321 C606C70000            595             MOV LINE2_COUNT, 00H
0326 C606CB0001            596             MOV RECEIVE_FLAG, 01H
032B EB7290                597             JMP SERIAL_END
                           598             
032E                       599     DISPLAY_ON_LCD:
032E 803EC70010            600             CMP LINE2_COUNT, LCD_DISPLAY_LIMIT
0333 7E29                  601             JLE NORMAL_DISPLAY_LCD_LINE2
0335 33DB                  602             XOR BX, BX
0337 8A1EC700              603             MOV BL, LINE2_COUNT
033B C687940020            604             MOV DISP_LINE2[BX], ' '
0340 FE06C700              605             INC LINE2_COUNT
0344 8A1EC700              606             MOV BL, LINE2_COUNT
0348 C687940020            607             MOV DISP_LINE2[BX], ' '
034D FE06C700              608             INC LINE2_COUNT
0351 8A1EC700              609             MOV BL, LINE2_COUNT
0355 C687940020            610             MOV DISP_LINE2[BX], ' '
035A FE06C700              611             INC LINE2_COUNT
                           612             
035E                       613     NORMAL_DISPLAY_LCD_LINE2:
035E 803ECB0000            614             CMP RECEIVE_FLAG, 00H
0363 743A                  615             JE SERIAL_END
0365 803EC70000            616             CMP LINE2_COUNT, 00H
036A 749D                  617             JE RECEIVE_CHARACTER_LINE2      
036C C606CB0000            618             MOV RECEIVE_FLAG, 00H
0371 C606CC0000            619             MOV LINE2_FLAG, 00H     
0376 C606D30000            620             MOV LCD_START, 00H
037B C606D40000            621             MOV LCD_FLAG, 00H
0380 C606D50000            622             MOV START_READ, 00H
0385 C606CA0000            623             MOV ROLL_COUNT, 00H
038A C706C8000000          624             MOV TIMER2_COUNT, 0000H
0390 9A3300----     R      625             CALL FAR PTR LCD_INITIALIZE
0395 9A0901----     R      626             CALL FAR PTR LCD_DISPLAY
039A 9A0000----     E      627             CALL FAR PTR SET_TIMER2
                           628             
039F                       629     SERIAL_END:
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE   13


LOC  OBJ                  LINE     SOURCE

039F 58                    630             POP AX
03A0 5B                    631             POP     BX
03A1 59                    632             POP     CX
03A2 CB                    633             RET
                           634     SERIAL_REC_ACTION ENDP
                           635     
                           636     
                           637     ;Main Timer2 Procedure
03A3                       638     TIMER2_ACTION PROC FAR
03A3 50                    639             PUSH AX
03A4 53                    640             PUSH BX
03A5 51                    641             PUSH CX
                           642                     
03A6 FF06C800              643             INC TIMER2_COUNT
03AA 833EC80050            644             CMP TIMER2_COUNT, TIMER2_LEN
03AF 756D                  645             JNE TIMER2_END          
03B1 C706C8000000          646             MOV TIMER2_COUNT, 0000H 
03B7 FE06CA00              647             INC ROLL_COUNT
03BB 803ECA000A            648             CMP ROLL_COUNT, ROLL_LIMIT
03C0 7C5C                  649             JL TIMER2_END
03C2 C606CA0010            650             MOV ROLL_COUNT, LCD_DISPLAY_LIMIT
                           651             
03C7 803EC60010            652             CMP LINE1_COUNT, LCD_DISPLAY_LIMIT
03CC 7E23                  653             JLE LINE2_SCROLL
                           654     
03CE 33DB                  655             XOR BX, BX
03D0 8A263000              656             MOV AH, DISP_LINE1[0]
03D4 8A0EC600              657             MOV CL, LINE1_COUNT
03D8 FEC9                  658             DEC CL
                           659     
03DA                       660     SWITCH_ARRAY_ELEMENTS_LINE1:
03DA 8A4731                661             MOV AL, DISP_LINE1[BX+1]
03DD 884730                662             MOV DISP_LINE1[BX], AL
03E0 43                    663             INC BX
03E1 E2F7                  664             LOOP SWITCH_ARRAY_ELEMENTS_LINE1
03E3 33DB                  665             XOR BX, BX
03E5 8A1EC600              666             MOV BL, LINE1_COUNT
03E9 88672F                667             MOV DISP_LINE1[BX-1], AH                
03EC 9A0901----     R      668             CALL FAR PTR LCD_DISPLAY        
                           669             
03F1                       670     LINE2_SCROLL:
03F1 803EC70010            671             CMP LINE2_COUNT, LCD_DISPLAY_LIMIT
03F6 7E26                  672             JLE TIMER2_END
                           673             
03F8 33DB                  674             XOR BX, BX
03FA 8A269400              675             MOV AH, DISP_LINE2[0]
03FE 8A0EC700              676             MOV CL, LINE2_COUNT
0402 FEC9                  677             DEC CL
                           678     
0404                       679     SWITCH_ARRAY_ELEMENTS_LINE2:
0404 8A879500              680             MOV AL, DISP_LINE2[BX+1]
0408 88879400              681             MOV DISP_LINE2[BX], AL
040C 43                    682             INC BX
040D E2F5                  683             LOOP SWITCH_ARRAY_ELEMENTS_LINE2
040F 33DB                  684             XOR BX, BX
8086/87/88/186 MACRO ASSEMBLER    TIMER                                                    19:31:02  12/07/;3  PAGE   14


LOC  OBJ                  LINE     SOURCE

0411 8A1EC700              685             MOV BL, LINE2_COUNT
0415 88A79300              686             MOV DISP_LINE2[BX-1], AH                
0419 9A0901----     R      687             CALL FAR PTR LCD_DISPLAY
                           688     
041E                       689     TIMER2_END:
041E 59                    690             POP CX
041F 5B                    691             POP BX
0420 58                    692             POP AX
0421 CB                    693             RET
                           694     TIMER2_ACTION ENDP
                           695     
                           696     
----                       697     CODE_SEG        ENDS
                           698     END

ASSEMBLY COMPLETE, NO ERRORS FOUND
